% !Mode:: "TeX:UTF-8"

\chapter{绪论}
\section{研究工作的背景与意义}\label{sec:mean}
根据摩尔定律芯片上的晶体管数量每18个月翻一番。随着这些数量空前庞大的晶体管集成在一个芯片上，当前的多核技术很快就会发展成上百核上千核的时代\citeup{borkar:DAC'07}。
已经有几十核的芯片投入生产，包括Tilera的64核处理器和intel的至强融核处理器。2012年Intel就发布了名为 Knights Corner 的至强融核协处理器，中国天河二号超级计算机就装了48000个Knights Corner芯片。
Knights Corner芯片上最多可容 61个内核。
intel下一代众核处理器 Knights Landing 可容下更多的核心。


多核和众核技术带来了极大的性能提升，但是我们不得不面对随之而来的功耗和热问题。
CMOS 技术的不断发展，功耗密度不断增长，就出现了高温热问题。不仅高的操作温度对微处理器的可靠性有负面影响，还有新的问题。
历史上，对芯片和封装设计做热建模，热工程师只需要使用芯片的总功耗，和一个温度值就能构建这个芯片的模型。
虽然这种方法在低功耗集成电路中仍然使用，但是对于高性能或者电源受限的设计中这是完全不适用的。
芯片上不断增长的非均匀功耗导致硅芯片上出现局部热点和高的温度梯度。
比如，在英特尔 90 nm 安腾处理器上，即使经过严格的热管理，局部温度仍然可以高达 $80 ^\circ$C ，同时芯片是其他部分温度相对较低（$61^\circ$C）\citeup{mcgowen2006power}。
在高性能多核和众核微处理器中，这种情况更加严重。过高的高温点必然导致可靠性问题，性能下降。
局部高温点问题是技术发展带来的一个副作用，这给热工程师，电路设计工程师，计算机设计师带来新的挑战。
%正在增长的功耗密度和空间上的功耗差距带来的局部热问题，
%导致性能下降，散热开销大，和严重的可靠性问题。
本来高功耗密度的冷却成本就已经很高，考虑到处理局部高温点，散热成本会更加的高，传统的散热方式比如风扇散热冷却方法已经无法满足需求。
所以找到经济和有效地方法去解决热问题同时提高多核和众核芯片的性能和可靠性仍然是一个挑战~\citeup{Brooks:MICRO'07}。


解决热问题可以从多方面来考虑，比如改进散热系统，改进芯片功能单元布局规划或者采用动态温度管理（DTM）技术。
传统空气散热方法因为其简单和低成本仍然被广泛应用。热问题更加严重，研究者也开始寻找更有效的冷却方法，已经有研究者开始研究液体冷却技术，因为水的比热较大。

针对处理器芯片热问题尤其是高性能芯片，在微体系结构级进行动态温度管理还是有巨大优势。
动态温度管理利用能使芯片自主修改任务的执行和功耗特性的技术，以使低开销的冷却方法也能保证芯片在安全温度以内。
动态温度管理控制器在系统运行时监控系统信息，并采取相应的热管理措施。以最小的性能损耗，尽可能地把系统温度保持在安全阈值以下，尽量平滑地修正热分布，有效提升系统的可靠性。
本文也主要针对动态温度管理进行讨论。



\section{动态热管理技术的发展}\label{sec:his}

动态温度管理方法是一个提升芯片热相关性能的有效技术 \citeup{Donald:ISCA'06}， 是随微处理器的发展而产生的技术。
管理问题的目的是寻找最优的资源管理策略，来有效控制芯片峰值温度，高温点数量和芯片热梯度。
现有的热管理研究可以主要分成两类：
\begin{enumerate}
\item 离线方法 : ~ 离线技术通常针对具有可预测负载的特定嵌入式系统，在设计阶段和编译阶段就解决温度感知的资源管理问题。
\item 在线方法 : ~ 在线技术针对设计阶段负载信息未知的更通用的平台，依靠有效的学习与控制技术，自适应管理硬件和软件来控制温度。
\end{enumerate}

很多不同的动态热管理操作都被研究过。这些操作包括时钟门控，动态电压频率调整，计算迁移等等。
或者是混合方法，就是上面两种或两种以上技术的结合。虽然不同的技术使用不同的机制，并且是用在不同的计算环境中的。
但是他们有一个相同的关键思想，就是修改计算系统功耗特性，使热产生量更少和温度分布更平滑。

两种最常用的动态温度管理操作就是任务迁移和动态电压频率调整：
%处理器在高性能水平运行时，动态温度管理通过控制处理器的运行行为，来保证处理器在安全温度以内。
%动态温度管理一般有两个方法，任务迁移和动态电压频率调整（DVFS），
\begin{enumerate}
\item 任务迁移 :  ~ 任务迁移方法通过交换多核或者众核处理器上任务来降低芯片的最高温度 \citeup{Powell:ASPLOS'04,Ge:DAC'10,Chantem:TVLSI'11,Liu:DATE'12,Ayoub:ISLPED'09,Ebi:ICCAD'09} ，
而且也可以降低多核系统的能量损耗 \citeup{Cong:ISLPED'12}。
所有核都在最大速度运行，所以任务迁移方法能使处理器得到更高的性能。但是如果没有其他动态温度管理方法的话，这个可能还是会有局部温度太高的问题。
\item 动态电压频率调整（DVFS） :  ~ 动态电压频率调整（DVFS）\citeup{Skadron:ISCA'03,Jayaseelan:ICCAD'09,Mutapcic:TCASI'09} 控制电压和操作频率来调整芯片的温度。
 最近，DVFS 也应用于暗硅领域 \citeup{Khdr:dac'15,Muthukaruppan:dac'13}，它随温度限制来改变电压和频率水平。
 DVFS 可以保证芯片的温度安全，但是因为频率的降低，芯片的计算性能就要下降。
\end{enumerate}


 
 
 为了使DVFS和任务迁移更有效，控制方案通常采用基于经验的动态温度管理方法。用控制器分析热模型，热传感信息等等，然后为动态温度管理操作做引导行为。
 例如，DVFS应该被调整到多少频率，任务迁移到哪一个核。
 最近的研究中提出了有很多混合方法。
 许多动态温度管理方法是基于传统控制方法的 \citeup{Kadin:GLSVLSI'09}，但是这些方法并不太适合多核和众核热系统，因为系统的复杂性 \citeup{Bartolini:TPDS'13}。 
 \cite{Brooks:HPCA'04}中提出了一种基于经验的结合 DVFS 和任务迁移的方法，但是并没有包含支持集成方法的理论。
 ~\cite{yeo2008predictive,coskun2008proactive} 中提出的方法是都是温度预测结合任务迁移，通过温度预测模型，进行任务迁移策略。
 当预测出一个核上的任务将要超出温度阈值的时候，就将该任务移出该核，移到预测温度最低的核。
 这种方法中虽然温度预测比较准确，能够降低芯片的平均温度，减少局部高温点，但是这种方法还是不能保证芯片温度在安全温度以下，而且对于高性能众核处理器来说效果将会变差。
 研究方向也多样，有针对性能的优化的混合方法 \citeup{Hanumaiah:TCAD'11}，有针对能耗的优化的混合方法 \citeup{Hanumaiah:TCOMP'14,Tan:ASPDAC'15}。
 
 最近，模型预测方法（MPC）被引入动态温度管理~\citeup{Zanini:ECCTD'09,Wang:ISCA'09,Bartolini:TPDS'13}。MPC利用芯片的热模型输出功率上的管理建议。
 因为这个方法在热行为上进行预测来得到更加有效的控制，所以 MPC 可以提供更有效和更精确的管理建议。对比于传统的方法，应用 MPC 有明显的性能提高~\citeup{Bartolini:TPDS'13}。
 很多研究方法结合 MPC 和 DVFS~\citeup{Zanini:ECCTD'09,Wang:ISCA'09,Bartolini:TPDS'13}，只用 DVFS 不能将处理器性能发挥到最大。
 
 DVFS和任务迁移结合MPC或许可以得到这三种方法的优点。MPC有高质量的预测控制，任务迁移提升更高的性能，DVFS保证温度的安全。
 %在这方面有许多研究，大都是结合这三种方法中的两种。
 然而， MPC 结合任务迁移要比 MPC 结合 DVFS 更难。
 %最近有研究混合了这三种方法 \citeup{MaWang:APCCAS'14}，但是这个方法只能应用于多核微处理器，因为在众核处理器中集成 MPC 和任务迁移将引入很大的开销。
 \cite{Hanumaiah:TCAD'11} 提出了一种类似于 MPC 的优化性能的混合方法，但是这种方法为了近似解决非线性优化问题，将核与核之间的热导忽略。
 
 \section{本论文的主要工作}\label{sec:thispaper}
在这篇文章中，针对高性能众核微处理器提出了新的动态温度管理方法。主
要包括两部分内容，第一部分是提出的基于模型预测控制结合任务迁移和 DVFS 的动态温度管理方法。
第二部分是针对第一部分中任务迁移决策的扩展性问题，提出了分层的动态温度管理方法。
新方法的第一部分利用模型预测控制以设定的目标温度来计算期望的输入功耗分布，
然后引导任务迁移和 DVFS 来调整当前的功耗分布去匹配期望的功耗分布。
任务迁移由二部图匹配做引导，DVFS只对有限数量的核进行电压频率调整，以保证CPU在热限制下的最大速度运行。
这个方法可以最大化处理器性能，最小化核之间温度差，而且核温度可以追踪目标温度。
新方法第二部分为了解决众核系统的执行集成 MPC 和任务迁移的可扩展性问题，将任务迁移部分分成两层，在第一层，相邻的核被分成一块，核功率的二部图匹配在块内执行来进行块内任务迁移。
没有匹配的核收集起来做第二层的任务迁移计算。在第二层的迁移结果计算中引入改进的迭代最小割算法来提速升计算速度。
新的分层方法对众核处理器来说，只需要很少的开销，而且高度可扩展既能保证高的处理器性能，又能保证温度不超过限制。
本论文方法的创新性贡献包括：
\begin{enumerate}
\item 在动态温度管理中，首次将模型预测控制方法与任务迁移和 DVFS 相结合，将任务迁移决策化为任务分配问题处理。
\item 针对任务迁移在众核处理器中的扩展性问题，创新性地将任务分配问题分层处理，并引入最小割算法辅助计算。
\item 实验证明，新提出的方法比 \cite{Zanini:ECCTD'09} 具有更大的性能优势，
      比 \cite{Hanumaiah:TCAD'11} 能进行更有效可靠的热控制，而且在开销和扩展性上具有极大的优势。
\end{enumerate}

 \section{本论文的结构安排}\label{sec:sec}
本论文的章节结构如下：

第一章绪论，首先介绍当前众核处理器发展，接着说明众核处理器面临的热问题。
然后展示了动态温度管理技术的发展和研究现状，最后说明本文主要工作，本论文的主要贡献与创新。

第二章对动态温度管理相关工作进行分析，首先分析对处理器芯片温度不受管理的负面影响。
其次，详细介绍动态温度管理操作技术：动态电压频率调整技术和任务迁移技术。
最后，介绍对动态温度管理操作进行引导的预测控制方法，包括本文中用到的模型预测控制（MPC）方法。

第三章介绍芯片热建模方法，先说明热传导理论，再主要介绍本文用到的 HotSpot 简洁热建模方法。

第四章 详细介绍本文新方法的第一部分即未分层方法，该方法基于模型预测控制结合任务迁移和 DVFS 的动态温度管理方法。主要对微处理器热模型进行说明，用模型预测控制方法计算期望功耗。
最后说明基于期望功耗怎样进行任务迁移。

第五章 详细介绍本文新动态温度管理方法中的第二部分，即分层方法。主要介绍将任务迁移决策分层计算，并且说明最后的 DVFS 调整。

第六章介绍本论文方法的实现，与结果比较。主要在瞬态温度，算法执行时间，和性能方面与其他方法进行比较，说明本论文提出的方法在众核芯片动态热管理中的优势。

第七章总结，对本文涉及到的内容和研究的方法进行总结。























